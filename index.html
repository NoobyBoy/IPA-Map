<!DOCTYPE HTML>
<!--
	Dimension by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>IPA Map</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>

	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">
			
					<!-- Header -->
				<header id="header">

					<div class="content">
						<div class="inner">
							<h1>International Phonetic Alphabet Map</h1>
							<p> Discover the sounds used by the languages all over the world.</p>
							
							<!-- Container for the map -->
							<div id="chartdiv" style="width: 100%;height: 600px;"></div>
							
							
						</div>
					</div>
				</header>
				
				<!-- Main -->
					<div id="main">

						<!-- Intro -->
							<article id="country-detail">
				                <div id="info-panel"></div>
							</article>

					</div>

				<!-- Footer -->
					<footer id="footer">
						<p class="copyright">&copy; IPA Map </p>
						<p class="copyright"> Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
					</footer>

			</div>

		<!-- BG -->
			<div id="bg"></div>
			


    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/map.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/geodata/worldLow.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
	<script src="https://unpkg.com/langs@2.0.0/langs.min.js"></script>
    <script>
		const specialCountries = //dict of country code where language is not exactly equal to the ISO Code provided by restcountries API
		{
		   'AL' : ['als'],
		   'AR' : ['spa', 'gug'],
		   'AS' : ['eng', 'smq'],
		   'PY' : ['spa', 'gug'],
		   'BO' : ['spa', 'ayr', 'gug', 'quh'],
		   'MA' : ['ary', 'tzm', 'shi'], //
		   'DZ' : ['arz'], //
		   'NO' : ['nob', 'sme'], // removed nno, smi => sme
		   'NP' : ['npi'], //
		   'NR' : ['eng'], // no  nau (nauruan)
		   'NU' : ['eng'],	// no niu (niuean)
		   'NZ' : ['eng', 'mri'],
		   'PE':  ['spa', 'ayr', 'quh'], //aym => ayr, que => quh
		   'PG' : ['eng'], // removed 'tpi' (tok pisin), 'hmo' (hiri motu)
		   'SC' : ['eng', 'fra'], // removed 'crs' (seychellois creole)
		   'SG' : ['eng', 'cmn', 'tam'], //removed 'msa' (malay)
		   'SZ' : ['eng'], // removed ssw (swati)
		   'TK' : ['eng'], // removed tkl (tokelauan), smo (samoan)
		   'TV' : ['eng'], // removed tvl (tuvaluan)
		   'TW' : ['cmn'], // no taiwainese mandarin codefound
		   'TZ' : ['eng', 'swh'], // swa => swh
		   'UG' : ['eng', 'swh'], // swa => swh
		   'UZ' : ['rus', 'uzn'], // uzb => uzn
		   'VA' : ['ita'], //remove 'lat'
		   'VU' : [ 'eng', 'fra'], // removed 'bis' (bislama),
		   'WS' : ['eng'], //removed smo (samoan)
		   'ZA' : ['afr', 'eng', 'nde',  'sot',  'xho', 'zul'], // nbl => nde, 'ven' (venda),'tso' (tsonga),'tsn' (tswana), 'ssw' (swati), 'nso' (Northern Sotho),
		   'ZW' : ['eng', 'kck', 'nde', 'sna', 'sot', 'toi',  'xho'] // removed : 'zib' , 'ven' (venda), 'tsn' (tswana), 'tso' (tsonga), 'nya' (chewa), 'ndc' (ndau), 'khi' (khoÃ¯san), 'bwg'
		} 
		
		const countryCodes = [
  'AD', 'AE', 'AF', 'AG', 'AI', 'AL', 'AM', 'AO', 'AR', 'AS', 'AT', 'AU', 'AW', 'AX', 'AZ',
  'BA', 'BB', 'BD', 'BE', 'BF', 'BG', 'BH', 'BI', 'BJ', 'BL', 'BM', 'BN', 'BO', 'BQ', 'BR', 'BS',
  'BT', 'BV', 'BW', 'BY', 'BZ', 'CA', 'CC', 'CD', 'CF', 'CG', 'CH', 'CI', 'CK', 'CL', 'CM', 'CN',
  'CO', 'CR', 'CU', 'CV', 'CW', 'CX', 'CY', 'CZ', 'DE', 'DJ', 'DK', 'DM', 'DO', 'DZ', 'EC', 'EE',
  'EG', 'EH', 'ER', 'ES', 'ET', 'FI', 'FJ', 'FK', 'FM', 'FO', 'FR', 'GA', 'GB', 'GD', 'GE', 'GF',
  'GG', 'GH', 'GI', 'GL', 'GM', 'GN', 'GP', 'GQ', 'GR', 'GS', 'GT', 'GU', 'GW', 'GY', 'HK', 'HM',
  'HN', 'HR', 'HT', 'HU', 'ID', 'IE', 'IL', 'IM', 'IN', 'IO', 'IQ', 'IR', 'IS', 'IT', 'JE', 'JM',
  'JO', 'JP', 'KE', 'KG', 'KH', 'KI', 'KM', 'KN', 'KP', 'KR', 'KW', 'KY', 'KZ', 'LA', 'LB', 'LC',
  'LI', 'LK', 'LR', 'LS', 'LT', 'LU', 'LV', 'LY', 'MA', 'MC', 'MD', 'ME', 'MF', 'MG', 'MH', 'MK',
  'ML', 'MM', 'MN', 'MO', 'MP', 'MQ', 'MR', 'MS', 'MT', 'MU', 'MV', 'MW', 'MX', 'MY', 'MZ', 'NA',
  'NC', 'NE', 'NF', 'NG', 'NI', 'NL', 'NO', 'NP', 'NR', 'NU', 'NZ', 'OM', 'PA', 'PE', 'PF', 'PG',
  'PH', 'PK', 'PL', 'PM', 'PN', 'PR', 'PS', 'PT', 'PW', 'PY', 'QA', 'RE', 'RO', 'RS', 'RU', 'RW',
  'SA', 'SB', 'SC', 'SD', 'SE', 'SG', 'SH', 'SI', 'SJ', 'SK', 'SL', 'SM', 'SN', 'SO', 'SR', 'SS',
  'ST', 'SV', 'SX', 'SY', 'SZ', 'TC', 'TD', 'TF', 'TG', 'TH', 'TJ', 'TK', 'TL', 'TM', 'TN', 'TO',
  'TR', 'TT', 'TV', 'TW', 'TZ', 'UA', 'UG', 'UM', 'US', 'UY', 'UZ', 'VA', 'VC', 'VE', 'VG', 'VI',
  'VN', 'VU', 'WF', 'WS', 'YE', 'YT', 'ZA', 'ZM', 'ZW'
];
		
		var languageDict = null;
		loadPhoibleData().then((result) => {
			languageDict = groupPhonemesByLanguage(result); 
			console.log(languageDict);
			countryCodes.forEach((code, index) => {
				GetIPAByCountryCode(code);

			});
		
		})
		.catch(console.error)
	    
		 
        // Create root element
        var root = am5.Root.new("chartdiv");

        // Set themes (optional, for better visuals)
        root.setThemes([
            am5themes_Animated.new(root)
        ]);

        // Create map chart
        var chart = root.container.children.push(
            am5map.MapChart.new(root, {
                panX: "rotateX",     // Flat panning (horizontal drag)
                panY: "translateY",        // Flat panning (vertical drag)
				wheelY: "zoom",      // Explicitly enable mouse wheel zoom (default, but good to set)
				wheelX: "none",      // Disable horizontal wheel (optional, default is none)
				minZoomLevel: 1,     // Optional: Prevent zooming out too far (1 = full world view)
				maxZoomLevel: 32,     // Optional: Allow deep zoom (adjust as needed)
                projection: am5map.geoMercator()
            })
        );

        // Create polygon series for countries
        var polygonSeries = chart.series.push(
            am5map.MapPolygonSeries.new(root, {
                geoJSON: am5geodata_worldLow,
				exclude: ["AQ"] // Exclude Antarctica, because it's ugly lol
            })
        );

        // Configure polygon template
        polygonSeries.mapPolygons.template.setAll({
            tooltipText: "{name}",
            interactive: true,
            fill: am5.color(0xbbbbbb), // Default fill color
			stroke: am5.color(0x000000), // Black border color
			strokeWidth: 1
        });

        // Hover state (optional)
        polygonSeries.mapPolygons.template.states.create("hover", {
            fill: am5.color(getRandomColor()) //random color each time you load the page
        });

		// Click event (attached to template)
		polygonSeries.mapPolygons.template.events.on("click", (ev) => onClick(ev));
		
		
        // Add zoom control (optional)
        chart.set("zoomControl", am5map.ZoomControl.new(root, {}));
		
		
		//===========================================//
		// functions
		//===========================================//
		
		async function onClick(ev) {
			var dataItem = ev.target.dataItem;
			var countryName = dataItem.get("name");
			var countryId = dataItem.get("id");   // ISO 2-letter code, e.g. "FR"

			if (!countryName) {
				countryName = dataItem.dataContext?.name || "Unknown";
			}
			if (!countryId) {
				countryId = dataItem.dataContext?.id || "N/A";
			}

		    // Use a reliable flag CDN (SVG for scalability; fallback to PNG if needed)
			var flagUrl = `https://flagcdn.com/${countryId.toLowerCase()}.svg`;
			
			var IPAs = await GetIPAByCountryCode(countryId);

			var info = `
				<h2 class="major">
				    <img src="${flagUrl}" alt="${countryName} Flag" width="32" height="24" style="vertical-align: middle; margin-right: 10px;">
					${countryName}
				</h2>
				<p>Lorem ipsum dolor sit amet<p>
			`;

			document.getElementById("info-panel").innerHTML = info;
			location.hash = "#country-detail";
		}

		function getRandomColor() {
		  var r, g, b;
		  do {
			r = Math.floor(Math.random() * 256);
			g = Math.floor(Math.random() * 256);
			b = Math.floor(Math.random() * 256);
			var max = Math.max(r, g, b);
			var min = Math.min(r, g, b);
		  } while (max - min < 30 && max - min > 230); // condition to not have grey colors or too flashy
		  return '#' +
			r.toString(16).padStart(2, '0').toUpperCase() +
			g.toString(16).padStart(2, '0').toUpperCase() +
			b.toString(16).padStart(2, '0').toUpperCase();
		}
		
		// Function to load and parse the CSV
		async function loadPhoibleData() {
			const url = 'https://raw.githubusercontent.com/phoible/dev/refs/heads/master/data/phoible.csv';
			
			try {
				const response = await fetch(url);
				if (!response.ok) {
					throw new Error(`Failed to fetch CSV: ${response.statusText}`);
				}
				
				const csvText = await response.text();
				
				// Parse with PapaParse (async callback style for large files)
				return new Promise((resolve, reject) => {
					Papa.parse(csvText, {
						header: true, // First row is headers (e.g., InventoryID, Glottocode, ISO6393, LanguageName, Phoneme)
						dynamicTyping: true, // Auto-convert numbers/strings
						skipEmptyLines: true,
						complete: (results) => {
							if (results.errors.length > 0) {
								reject(results.errors);
							} else {
								resolve(results.data); // Array of objects, e.g., [{ InventoryID: 1, Glottocode: 'stan1293', ... }]
							}
						}
					});
				});
			} catch (error) {
				console.error('Error loading PHOIBLE data:', error);
				return [];
			}
		}
		
		function groupPhonemesByLanguage(data) {
			const grouped = {};
			data.forEach(row => {
				const lang = row.ISO6393 || row.Glottocode; // Use ISO or Glottocode as key
				if (!grouped[lang]) grouped[lang] = new Set();
				grouped[lang].add(row.Phoneme); // Add unique IPA symbols
			});
			return grouped; // e.g., { 'eng': Set(['p', 'b', 't', ...]) }
		}
		
		async function GetIPAByCountryCode(countrycode) {
			var codes;
			const res = await fetch(`https://restcountries.com/v3.1/alpha/${countrycode}`);
			const data = await res.json();
			const country = data[0];
			// Official languages (ISO 639-1 or 2)
			const languages = country.languages;
			// Codes
			codes = Object.keys(languages);
			codes.forEach((code, index) => {
			  if (code === "ara") {
				codes[index] = "arz";
			  }
			});
			
			if (typeof specialCountries[countrycode] != 'undefined')
			{
				//remove this code
				codes = specialCountries[countrycode];
			}


			//console.log(codes);

			var IPAList = [];
			codes.forEach((code) => { 
			  IPAList.push(languageDict[code]);  
			  if ( typeof languageDict[code] === 'undefined' ) {console.log(country.name.common);console.log(countrycode);console.log(codes);console.log(code);}
			});

			//console.log(IPAList);
			return IPAList;
		}
		
    </script>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>
